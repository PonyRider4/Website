<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soft Wealth | 舒适的搞钱哲学</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { main: '#EBECF0', text: { main: '#4B5563', dark: '#1F2937' }, accent: '#6D5DFC' },
                    fontFamily: { sans: ['"Nunito"', 'sans-serif'] },
                    boxShadow: {
                        'neu-out': '6px 6px 12px #b8b9be, -6px -6px 12px #ffffff',
                        'neu-in': 'inset 4px 4px 8px #b8b9be, inset -4px -4px 8px #ffffff',
                    }
                }
            }
        }
    </script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        body { background-color: #EBECF0; color: #4B5563; font-family: sans-serif; }
        .btn-neu { transition: 0.2s; box-shadow: 6px 6px 12px #b8b9be, -6px -6px 12px #ffffff; color: #6D5DFC; }
        .btn-neu:active { box-shadow: inset 4px 4px 8px #b8b9be, inset -4px -4px 8px #ffffff; transform: translateY(1px); }
        .shadow-neu-out { box-shadow: 6px 6px 12px #b8b9be, -6px -6px 12px #ffffff; }
        .shadow-neu-in { box-shadow: inset 4px 4px 8px #b8b9be, inset -4px -4px 8px #ffffff; }
        
        /* Markdown 样式 */
        .prose h1, .prose h2 { color: #1F2937; font-weight: 800; margin-top: 1.5em; font-size: 1.5rem; }
        .prose p { margin-bottom: 1.2em; line-height: 1.7; }
        .prose img { border-radius: 1rem; box-shadow: 6px 6px 12px #b8b9be, -6px -6px 12px #ffffff; border: 4px solid #EBECF0; my-4; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose blockquote { padding: 1rem; background: #E1E2E5; border-radius: 0.5rem; border-left: 4px solid #6D5DFC; margin: 1.5em 0; }
        .prose pre { background: #1f2937; color: #fff; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
        
        .fade-enter-active, .fade-leave-active { transition: opacity 0.4s ease, transform 0.4s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; transform: translateY(10px); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4">

    <div id="app" class="w-full max-w-5xl">
        <nav class="flex justify-between items-center px-8 py-4 rounded-3xl shadow-neu-out mb-12 bg-main">
            <div @click="currentView='list'" class="flex items-center gap-3 cursor-pointer select-none">
                <div class="w-10 h-10 rounded-full flex items-center justify-center text-accent text-xl shadow-neu-out">
                    <i class="ri-cloud-windy-line"></i>
                </div>
                <h1 class="font-extrabold text-xl text-text-dark">Soft Wealth</h1>
            </div>
        </nav>

        <main>
            <transition name="fade" mode="out-in">
                <div v-if="currentView === 'list'" key="list">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <article v-for="post in posts" :key="post.id" @click="loadPost(post)" 
                            class="p-6 rounded-3xl shadow-neu-out cursor-pointer hover:shadow-neu-in transition-all duration-300 transform hover:-translate-y-1">
                            <div class="h-48 rounded-2xl shadow-neu-in mb-6 overflow-hidden border-4 border-main">
                                <img :src="post.image" class="w-full h-full object-cover opacity-90 hover:scale-105 transition duration-700">
                            </div>
                            <h3 class="text-xl font-extrabold text-text-dark mb-3">{{ post.title }}</h3>
                            <p class="text-sm text-text-main line-clamp-2 mb-4">{{ post.excerpt }}</p>
                            <span class="text-xs font-bold text-accent">{{ post.date }}</span>
                        </article>
                    </div>
                </div>

                <div v-else key="detail" class="max-w-3xl mx-auto">
                    <button @click="currentView='list'" class="mb-8 px-6 py-2 rounded-full shadow-neu-out text-accent font-bold active:shadow-neu-in">
                        <i class="ri-arrow-left-line"></i> 返回列表
                    </button>

                    <article class="p-8 md:p-12 rounded-[2.5rem] shadow-neu-out bg-main">
                        <div class="text-center mb-10">
                            <h1 class="text-3xl md:text-4xl font-extrabold text-text-dark leading-tight mb-4">{{ activePost.title }}</h1>
                            <span class="text-sm font-bold text-gray-400">{{ activePost.date }}</span>
                        </div>
                        
                        <div v-if="loading" class="text-center py-20 text-accent font-bold">加载文章中...</div>
                        <div v-else class="prose max-w-none" v-html="compiledMarkdown"></div>
                    </article>
                </div>
            </transition>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const currentView = ref('list');
                const posts = ref([]);
                const activePost = ref(null);
                const markdownContent = ref('');
                const loading = ref(false);

                // 1. 启动时，去 posts.json 获取文章列表
                onMounted(async () => {
                    try {
                        const response = await fetch('posts.json');
                        posts.value = await response.json();
                    } catch (e) {
                        console.error("找不到 posts.json", e);
                    }
                });

                // 2. 点击文章时，去 fetch 对应的 .md 文件
                const loadPost = async (post) => {
                    activePost.value = post;
                    currentView.value = 'detail';
                    loading.value = true;
                    markdownContent.value = ''; // 清空缓存
                    
                    try {
                        const res = await fetch(post.file); // 关键：读取文件路径
                        if (!res.ok) throw new Error('文章不存在');
                        markdownContent.value = await res.text();
                    } catch (e) {
                        markdownContent.value = "> ⚠️ 无法加载文章内容，请检查文件名是否正确。";
                    } finally {
                        loading.value = false;
                        window.scrollTo(0, 0);
                    }
                };

                const compiledMarkdown = computed(() => marked.parse(markdownContent.value));

                return { currentView, posts, activePost, loadPost, compiledMarkdown, loading };
            }
        }).mount('#app');
    </script>
</body>
</html>
